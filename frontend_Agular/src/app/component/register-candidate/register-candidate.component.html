<!-- Sign Up form -->
<div class="signup-page">
  <form
    [formGroup]="registrationForm"
    (ngSubmit)="handleCandidateRegistration()"
  >
    <!-- Si on est PAS en mode édition, afficher "Inscriptionandidat" -->
    <h3 *ngIf="!isEdit && !isAddNote">
      {{ "change-role.candidate" | translate }}
    </h3>

    <!-- Si on est en mode édition, afficher "Modifier le candidat" -->
    <h3 *ngIf="isEdit && !isAddNote">
      {{ "change-update.candidate" | translate }}
    </h3>

    <!-- Si on est en mode édition, afficher "Modifier le candidat" -->
    <h3 *ngIf="isAddNote && !isEdit">
      {{ "change-candidate-note" | translate }}
    </h3>

    <!-- Pour le champ 'name' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="name" class="name">
        {{ "change-name" | translate }}<span class="required-field">*</span>
      </label>
      <input
        type="text"
        class="form-control"
        placeholder="Name"
        formControlName="name"
        [class.is-invalid]="name?.invalid && (name?.dirty || name?.touched)"
      />
      <div
        *ngIf="name?.invalid && (name?.dirty || name?.touched)"
        class="error-message"
      >
        <div *ngIf="name?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="name?.errors?.['minlength']">
          {{ "name-must-be-at-least-2-characters-long" | translate }}
        </div>
        <div *ngIf="name?.errors?.['maxlength']">
          {{ "name-must-be-at-least-2-characters-long" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'name' -->

    <!-- Pour le champ 'firstname' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="firstname" class="name">
        {{ "change-firstname" | translate
        }}<span class="required-field">*</span>
      </label>
      <input
        type="text"
        class="form-control"
        placeholder="Firstname"
        formControlName="firstname"
        [class.is-invalid]="
          firstname?.invalid && (firstname?.dirty || firstname?.touched)
        "
      />
      <div
        *ngIf="firstname?.invalid && (firstname?.dirty || firstname?.touched)"
        class="error-message"
      >
        <div *ngIf="firstname?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="firstname?.errors?.['minlength']">
          {{ "firstname-must-be-at-least-2-characters-long" | translate }}
        </div>
        <div *ngIf="firstname?.errors?.['maxlength']">
          {{ "firstname-must-be-less-than-50-characters-long" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'firstname' -->
    <!-- Pour le champ 'dateBirth' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="dateBirth" class="name">
        {{ "change-birthday" | translate }}<span class="required-field">*</span>
      </label>
      <input
        type="date"
        class="form-control"
        id="dateBirth"
        placeholder="Date"
        formControlName="dateBirth"
        [class.is-invalid]="
          dateBirth?.invalid && (dateBirth?.dirty || dateBirth?.touched)
        "
      />
      <div
        *ngIf="dateBirth?.invalid && (dateBirth?.dirty || dateBirth?.touched)"
        class="error-message"
      >
        <div *ngIf="dateBirth?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'dateBirth' -->

    <!-- Pour le champ 'sex' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="sex" class="name">
        {{ "change-gender" | translate }}<span class="required-field">*</span>
      </label>
      <div class="col-md-6 mb-4">
        <select
          class="select"
          formControlName="sex"
          id="sex"
          [class.is-invalid]="sex?.invalid && (sex?.dirty || sex?.touched)"
        >
          <option value="" disabled selected>
            {{ "change-choice" | translate }}
          </option>
          <option value="F">{{ "change-female" | translate }}</option>
          <option value="M">{{ "change-male" | translate }}</option>
        </select>
      </div>
      <div
        *ngIf="sex?.invalid && (sex?.dirty || sex?.touched)"
        class="error-message"
      >
        <div *ngIf="sex?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="sex?.errors?.['maxlength']">
          {{ "Invalid-selection" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'sex' -->
    <!-- Dysplay Error message -->
    <p class="error-message" *ngIf="errorMessage">
      {{ errorMessage | translate }}
    </p>
    <!-- End Dysplay Error message -->

    <!-- Pour le champ 'phoneNumber' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="phoneNumber" class="name">
        {{ "change-phone-number" | translate
        }}<span class="required-field">*</span></label
      >
      <input
        type="text"
        class="form-control"
        placeholder="ex: +32 123456789"
        formControlName="phoneNumber"
        id="phoneNumber"
        [class.is-invalid]="
          phoneNumber?.invalid && (phoneNumber?.dirty || phoneNumber?.touched)
        "
      />
      <div
        *ngIf="
          phoneNumber?.invalid && (phoneNumber?.dirty || phoneNumber?.touched)
        "
        class="error-message"
      >
        <div *ngIf="phoneNumber?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="phoneNumber?.errors?.['pattern']">
          {{ "invalid-phone-number-format" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'phoneNumber' -->
    <!-- Pour le champ 'email' -->
    <div *ngIf="!isEdit && !isAddNote" class="form-group">
      <label for="email" class="name"
        >Email<span class="required-field">*</span></label
      >
      <input
        type="email"
        class="form-control"
        placeholder="Email"
        formControlName="email"
        [class.is-invalid]="email?.invalid && (email?.dirty || email?.touched)"
        id="email"
      />
      <div
        *ngIf="email?.invalid && (email?.dirty || email?.touched)"
        class="error-message"
      >
        <div *ngIf="email?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="email?.errors?.['email']">
          {{ "please-enter-a-valid-email-address" | translate }}
        </div>
        <div *ngIf="email?.errors?.['maxlength']">
          {{ "email-can-be-maximum-70-characters-long" | translate }}
        </div>
        <div *ngIf="email?.errors?.['pattern']">
          {{ "errors.emailInvalid" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'email' -->

    <!-- Pour le champ 'password' -->
    <div *ngIf="!isEdit && !isAddNote" class="col-12">
      <label for="password" class="name">
        {{ "change-login.password" | translate
        }}<span class="required-field">*</span>
      </label>
      <div class="input-group">
        <input
          [type]="showPassword ? 'text' : 'password'"
          class="form-control"
          placeholder="{{ 'change-login.password' | translate }}"
          formControlName="password"
          [class.is-invalid]="
            password?.invalid && (password?.dirty || password?.touched)
          "
          id="password"
        />
        <span class="input-group-text icone" (click)="toggleShowPassword()">
          <i
            class="fas"
            [class.fa-eye]="!showPassword"
            [class.fa-eye-slash]="showPassword"
          ></i>
        </span>
      </div>
      <!-- Affichage des messages d'erreur -->
      <div
        *ngIf="password?.invalid && (password?.dirty || password?.touched)"
        class="error-message"
      >
        <div *ngIf="password?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="password?.errors?.['maxlength']">
          {{ "password-cannot-be-more-than-250-characters-long" | translate }}
        </div>
        <div *ngIf="password?.errors?.['pattern']">
          {{ "errors.passwordRequirements" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'password' -->

    <!-- Pour le champ 'jobTitleId' -->
    <div class="form-group margin" *ngIf="!isAddNote">
      <label for="jobTitleId" class="name"
        >{{ "change-function" | translate
        }}<span class="required-field">*</span></label
      >
      <div class="col-md-12 mb-4">
        <select
          class="form-control"
          class="select form-control"
          id="jobTitleId"
          formControlName="jobTitleId"
          [class.is-invalid]="
            jobTitleId?.invalid && (jobTitleId?.dirty || jobTitleId?.touched)
          "
        >
          <option value="" disabled selected>
            {{ "select-job-title" | translate }}
          </option>
          <option
            *ngFor="let jobTitle of jobTitles"
            [value]="jobTitle.jobTitleId"
          >
            {{ "JOBTITLES." + jobTitle.title | translate }}
          </option>
        </select>
      </div>
      <!-- Affichage des messages d'erreur pour 'jobTitleId' -->
      <div
        *ngIf="
          jobTitleId?.invalid && (jobTitleId?.dirty || jobTitleId?.touched)
        "
        class="error-message"
      >
        <div *ngIf="jobTitleId?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'jobTitleId' -->

    <!-- Pour le champ 'experienceId' -->
    <div class="form-group margin" *ngIf="!isAddNote">
      <label for="experienceId" class="name"
        >{{ "change-experience" | translate
        }}<span class="required-field">*</span></label
      >
      <div class="col-md-12 mb-4">
        <select
          class="form-control"
          class="select form-control"
          id="experienceId"
          formControlName="experienceId"
          [class.is-invalid]="
            experienceId?.invalid &&
            (experienceId?.dirty || experienceId?.touched)
          "
        >
          <option value="" disabled selected>
            {{ "select-job-title" | translate }}
          </option>
          <option
            *ngFor="let experience of experiences"
            [value]="experience.experienceId"
          >
            {{ experience.title | translate }}
          </option>
        </select>
      </div>
      <!-- Affichage des messages d'erreur pour 'jobTitleId' -->
      <div
        *ngIf="
          experienceId?.invalid &&
          (experienceId?.dirty || experienceId?.touched)
        "
        class="error-message"
      >
        <div *ngIf="experienceId?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'experienceId' -->

    <!-- Pour le champ 'adresse' -->
    <div class="form-group" *ngIf="!isAddNote">
      <label for="address" class="name"
        >{{ "change-address" | translate
        }}<span class="required-field">*</span></label
      >
      <input
        type="text"
        class="form-control"
        placeholder="{{ 'change-address' | translate }}"
        formControlName="address"
        [class.is-invalid]="
          address?.invalid && (address?.dirty || address?.touched)
        "
        id="address"
      />
      <div
        *ngIf="address?.invalid && (address?.dirty || address?.touched)"
        class="error-message"
      >
        <div *ngIf="address?.errors?.['required']">
          {{ "this-field-is-required" | translate }}
        </div>
        <div *ngIf="address?.errors?.['minlength']">
          {{ "address-must-be-at-least-2-characters-long" | translate }}
        </div>
        <div *ngIf="address?.errors?.['maxlength']">
          {{ "address-must-be-at-least-70-characters-long" | translate }}
        </div>
      </div>
    </div>
    <!-- End 'address' -->

    <!-- Start 'interviewNote' -->
    <div
      class="form-group"
      *ngIf="isAdmin || (isConsultant && isAuthenticated)"
    >
      <div class="container mt-3">
        <div class="mb-3">
          <label for="interviewNote" class="name">
            {{ "change-interviewNote" | translate
            }}<span class="required-field">*</span></label
          >
          <textarea
            class="form-control"
            id="interviewNote"
            formControlName="interviewNote"
            rows="4"
            placeholder="{{ 'change-enter-interviewNote' | translate }}"
            [class.is-invalid]="
              interviewNote?.invalid &&
              (interviewNote?.dirty || interviewNote?.touched)
            "
          ></textarea>
          <!-- Messages d'erreur pour la validation -->
          <div
            *ngIf="
              interviewNote?.invalid &&
              (interviewNote?.dirty || interviewNote?.touched)
            "
            class="error-message"
          >
            <div *ngIf="interviewNote?.errors?.['required']">
              {{ "this-field-is-required" | translate }}
            </div>
            <div *ngIf="interviewNote?.errors?.['minlength']">
              {{ "note-must-be-at-least-10-characters-long" | translate }}
            </div>
            <div *ngIf="interviewNote?.errors?.['maxlength']">
              {{ "note-must-be-less-than-1500-characters-long" | translate }}
            </div>
          </div>
        </div>
        <div
          [innerHTML]="noteText"
          style="
            white-space: pre-line;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 20px;
          "
        ></div>
      </div>
    </div>
    <!-- End 'descriptionCompany' -->

    <!-- Pour le champ 'cv', incluant le message d'erreur pour la validation du fichier -->
    <div class="form-group" *ngIf="!isEdit && !isAddNote">
      <label class="name">{{ "change-cv" | translate }}</label>
      <input
        type="file"
        id="cv"
        class="form-control"
        placeholder="{{ 'change-address' | translate }}"
        (change)="onFileSelected($event)"
        accept=".pdf"
        [class.is-invalid]="cv?.invalid && (cv?.dirty || cv?.touched)"
      />

      <div
        *ngIf="cv?.invalid && (cv?.dirty || cv?.touched)"
        class="error-message"
      >
        <!-- Affichage des messages d'erreur pour le champ 'cv' -->
        <div *ngIf="registrationForm.controls['cv'].errors">
          <div *ngIf="registrationForm.controls['cv'].errors['requiredFile']">
            {{ "this-field-is-required" | translate }}
          </div>
          <div
            *ngIf="registrationForm.controls['cv'].errors['invalidFileType']"
          >
            {{ "errors.file-must-be-in-pdf-format" | translate }}
          </div>
          <div
            *ngIf="registrationForm.controls['cv'].errors['fileSizeExceeded']"
          >
            {{ "errors.file-must-be-less-than-5mb" | translate }}
          </div>
        </div>
      </div>
    </div>
    <!-- End 'cv' -->

    <!--   <div class="d-grid gap-2 d-md-flex justify-content-md-center">
      <button type="submit" class="btn">
        {{ "change-language.Sign-Up" | translate }}
      </button>

      <button
        class="btn btn-back btn-secondary me-md-2"
        type="button"
        (click)="backHome()"
      >
        <i class="fa-solid fa-circle-xmark"></i>
        {{ "change-role.exit" | translate }}
      </button -->
    <br />
    <div
      *ngIf="!isEdit && !isAddNote"
      style="display: flex; width: 100%; max-width: 600px; margin: auto"
    >
      <button
        class="save-button"
        mat-raised-button
        type="submit"
        style="flex-grow: 1; margin-right: 4px"
      >
        <span class="material-icons">save</span>
        Save
      </button>
      <button
        (click)="redirectToHome()"
        class="btn-save"
        mat-raised-button
        style="flex-grow: 1; margin-left: 4px"
      >
        <span class="material-icons">cancel</span>
        Close
      </button>
    </div>

    <hr />
    <div *ngIf="!isEdit && !isAddNote" class="form-group">
      <p class="text-center">
        {{ "change-have-account?" | translate }}
        <a href="/signin"> {{ "change-language.login" | translate }}</a>
      </p>
    </div>

    <div *ngIf="isEdit || isAddNote" class="update-div">
      <button
        class="save-button"
        mat-raised-button
        type="submit"
        style="flex-grow: 1; margin-right: 4px"
      >
        <span class="material-icons">edit</span>
        Modifier
      </button>
      <button
        class="btn-save"
        mat-raised-button
        [mat-dialog-close]="false"
        style="flex-grow: 1; margin-left: 4px"
      >
        <span class="material-icons">cancel</span>
        Close
      </button>
    </div>
  </form>
</div>
